{% extends 'base.html' %}
{% load static %}

{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/datatable/dataTables.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static 'css/openlayers/ol.css' %}" type="text/css">
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active">{{ breadcrumb }}</li>
{% endblock %}

{% block content %}
{% if events %}
<div id="map" class="map">
  <div id="popup"></div>
</div>
{% endif %}

<script type="text/javascript">
    $(document).ready(function() {
        $('#events_table').DataTable();
    });
</script>

<script src="{% static 'js/openlayers/ol.js' %}"></script>
<script src="{% static 'js/openlayers/olStationbook.js' %}"></script>
<h1>Recent events</h1>
<table id="events_table" class="table" cellspacing="0" width="100%">
  <thead>
    <tr>
      <th>
        Event origin time
        <small class="text-muted d-block">(click for details)</small>
      </th>
      <th>
        Flinn-Engdahl Region
        <small class="text-muted d-block">(click to zoom)</small>
      </th>
      <th>Magnitude</th>
      <th>Depth</th>
    </tr>
  </thead>
  <tbody>
    {% for e in events %}
    <tr>
      <td><a href="{% url 'event_details' e.get_public_id %}">{{ e.parse_origin_time }}</a></td>
      <td>
        <a href="#" onclick="zoomEvent(parseFloat('{{ e.origin_latitude }}'),parseFloat('{{ e.origin_longitude }}'));">{{ e.get_flinn_engdahl }}</a>
        <small class="text-muted d-block">Latitude: {{ e.origin_latitude }}, Longitude: {{ e.origin_longitude }}</small>
      </td>
      <td>{{ e.magnitude_value }}</td>
      <td>{{ e.origin_depth }}</td>
    </tr>
    <script type="text/javascript">
      var getEventColor=function(value){if(value<2.0){return'#75FF33'}else if(value<4.0){return'#DBFF33'}else if(value<6.0){return'#FFBD33'}else{return'#FF5733'}}
      var latitude=parseFloat("{{ e.origin_latitude }}"),longitude=parseFloat("{{ e.origin_longitude }}"),depth=parseFloat("{{ e.origin_depth }}"),magnitude=parseFloat("{{ e.magnitude_value }}");if(!isNaN(latitude)&&!isNaN(longitude)){var point=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([longitude,latitude])),name:`<b>Time:</b> {{ e.parse_origin_time }}<br><b>Flinn Engdahl Region:</b> {{ e.get_flinn_engdahl }}<br><b>Latitude:</b> ${latitude}<br><b>Longitude:</b> ${longitude}<br><b>Magnitude:</b> ${magnitude}<br><b>Depth:</b> ${depth}`});point.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:magnitude**2/4,fill:new ol.style.Fill({color:getEventColor(magnitude)}),stroke:new ol.style.Stroke({color:'#000000',width:1})})})),vectorSource.addFeature(point)}
      var zoomEvent=function(lat,lon){$(element).popover('dispose');map.getView().animate({center:ol.proj.fromLonLat([lon,lat]),duration:1000,zoom:7})}
    </script>
    {% endfor %}
  </tbody>
</table>

{% block javascript %}
<script src="{% static 'js/datatable/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'js/datatable/dataTables.bootstrap4.min.js' %}"></script>
{% endblock %}
{% endblock %}